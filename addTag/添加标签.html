<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>双十一移动端添加标签页面</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script>
        (function () {
            if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
                var version = parseFloat(RegExp.$1);
                if (version > 2.3) {
                    var width = window.outerWidth == 0 ? window.screen.width : window.outerWidth;
                    var phoneScale = parseInt(width) / 500;
                    document.write('<meta name="viewport" content="width=500, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
                }
                else {
                    document.write('<meta name="viewport" content="width=500, target-densitydpi=device-dpi">');
                }
            }
            else if (navigator.userAgent.indexOf('iPhone') != -1) {
                var phoneScale = parseInt(window.screen.width) / 500;
                document.write('<meta name="viewport" content="width=500, height=750,initial-scale=' + phoneScale + ',user-scalable=no" /> ');
            }
            else {
                document.write('<meta name="viewport" content="width=500, height=750,initial-scale=0.64" /> ');
            }
        })();
    </script>
    <link rel="stylesheet" href="../css/addTag.css" />
</head>
<body id='body'>
    <div id="cardsound" class="cardsound">
        <img id="sound_image" class="sound_image" src="../images/d11/2016d11-music.png" />
        <audio id="audioPlay" data-play="1" loop="loop" autoplay>
            <source src="http://img.huimaiche.cn/uimg/www/v20160804/mini/1.ogg" type="audio/ogg">
            <source src="http://img.huimaiche.cn/uimg/www/v20160804/mini/1.mp3" type="audio/mpeg">
            <source src="http://img.huimaiche.cn/uimg/www/v20160804/mini/1.m4a" type="audio/mpeg">
            <source src="http://img.huimaiche.cn/uimg/www/v20160804/mini/1.wav" >
        </audio>
        <div id="music_txt" class="music_txt"></div>
    </div>
    <div id='img_bg1'></div>
    <div id='img_bg'></div>
    <img id='img' data-sex='1' src="../images/d11/2016d11-portrait.jpg"/>
    <div id='contain1' class="contain2">
        <div class="d11-heart"></div>
        <button id='button1' class='button' data-clicked="0" data-index="1" data-count="1">充气<br>娃娃<br>(1)</button>
        <div class='text' id='text1'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain2' class="contain1">
        <div class="d11-heart"></div>
        <button id='button2' class='button' data-clicked="0" data-index="2" data-count="4">打火机<br>(4)</button>
        <div class='text' id='text2'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain3' class="contain1">
        <div class="d11-heart"></div>
        <button id='button3' class='button' data-clicked="0" data-index="3" data-count="5">女朋友<br>(5)</button>
        <div class='text' id='text3'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain4' class="contain1">
        <div class="d11-heart"></div>
        <button id='button4' class='button' data-clicked="0" data-index="4" data-count="1">肥皂<br>(1)</button>
        <div class='text' id='text4'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain5' class="contain1">
        <div class="d11-heart"></div>
        <button id='button5' class='button' data-clicked="0" data-index="5" data-count="3">洗衣粉<br>(3)</button>
        <div class='text' id='text5'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain6' class="contain1">
        <div class="d11-heart"></div>
        <button id='button6' class='button' data-clicked="0" data-index="6" data-count="1">男朋友<br>(1)</button>
        <div class='text' id='text6'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain7' class="contain1">
        <div class="d11-heart"></div>
        <button id='button7' class='button' data-clicked="0" data-index="7" data-count="3">避孕套<br>(3)</button>
        <div class='text' id='text7'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain8' class="contain2">
        <div class="d11-heart"></div>
        <button id='button8' class='button' data-clicked="0" data-index="8" data-count="3">64G大<br>容量U盘<br>(3)</button>
        <div class='text' id='text8'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain9' class="contain1">
        <div class="d11-heart"></div>
        <button id='button9' class='button' data-clicked="0" data-index="9" data-count="8">自恋<br>(8)</button>
        <div class='text' id='text9'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <div id='contain10' class="contain1">
        <div class="d11-heart"></div>
        <button id='button10' class='button' data-clicked="0" data-index="10" data-count="4">情商高<br>(4)</button>
        <div class='text' id='text10'>+1</div>
        <div class="d11-break1"></div>
        <div class="d11-break2"></div>
    </div>
    <a href="#" class="double11-guess">看看小伙伴会给我选什么</a>
    <a href="#" class="double11-hands">这个别点开！怕你剁手</a>
    <div class="double11-mask">
        <div class="double11-turntop"></div>
        <div class="double11-words"></div>
        <div class="double11-sure">确定</div>
    </div>
<script>
    /* 控制拖动 */
    var obj1 = document.getElementById('button1');
    drag(obj1);
    var obj2 = document.getElementById('button2');
    drag(obj2);
    var obj3 = document.getElementById('button3');
    drag(obj3);
    var obj4 = document.getElementById('button4');
    drag(obj4);
    var obj5 = document.getElementById('button5');
    drag(obj5);
    var obj6 = document.getElementById('button6');
    drag(obj6);
    var obj7 = document.getElementById('button7');
    drag(obj7);
    var obj8 = document.getElementById('button8');
    drag(obj8);
    var obj9 = document.getElementById('button9');
    drag(obj9);
    var obj10 = document.getElementById('button10');
    drag(obj10);
    var only_out = 0;
    var only_in = 0;
    var lastTime = 0;
    var prefixes = 'webkit moz ms o'.split(' ');
    var requestAnimationFrame = window.requestAnimationFrame;
    var cancelAnimationFrame = window.cancelAnimationFrame;
    var prefix;
    for (var i = 0; i < prefixes.length; i++) {
        if (requestAnimationFrame && cancelAnimationFrame) {
            break;
        }
        prefix = prefixes[i];
        requestAnimationFrame = requestAnimationFrame || window[prefix + 'RequestAnimationFrame'];
        cancelAnimationFrame = cancelAnimationFrame || window[prefix + 'CancelAnimationFrame'] || window[prefix + 'CancelRequestAnimationFrame'];
    }

    if (!requestAnimationFrame || !cancelAnimationFrame) {
        requestAnimationFrame = function (callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 1000 / 300 - ( currTime - lastTime ));
            var id = window.setTimeout(function () {
                callback(currTime + timeToCall);
            }, timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
        cancelAnimationFrame = function (id) {
            window.clearTimeout(id);
        };
    }

    window.requestAnimationFrame = requestAnimationFrame;
    window.cancelAnimationFrame = cancelAnimationFrame;

    function drag(element) {
        var id = parseInt(element.id.replace("button", ""));
        var startX = 0,startY = 0, ticking = false, ticking1 = false, raf;
        var tmp = "contain" + id;
        var tmp1 = "#contain" + id;
        var tmp2 = "animation2" + id;
        var doc = element;
        doc.addEventListener("touchstart", function (e) {
            var e = e || window.event;
            var touchs = e.touches[0];
            startX = parseInt(touchs.pageX);
            startY = parseInt(touchs.pageY);
        }, false);

        doc.addEventListener("touchmove", function (e) {
            var e = e || window.event;
            if (e.touches.length > 1 || e.scale && e.scale !== 1) {
                return;
            }
            e.preventDefault();
            if (!ticking) {
                var touchs = e.changedTouches[0];
                doc.lefts = touchs.pageX - startX;
                doc.tops = touchs.pageY - startY;
                raf = requestAnimationFrame(draw);
            }
            ticking = true;
        }, false);
        doc.addEventListener("touchend", function (e) {
            var e = e || window.event;
            if (e.touches.length > 1 || e.scale && e.scale !== 1) return;
            if (!ticking1) {
                var touchs = e.changedTouches[0];
                doc.lefts = startX - touchs.pageX;
                doc.tops = startY - touchs.pageY;
                raf = requestAnimationFrame(clear);
            }
            ticking1 = true;
        }, false);
        var draw = function () {
            ticking = false;
            var nowLeft = parseInt(doc.lefts);  //滑动的距离
            var nowTop = parseInt(doc.tops);    //滑动的距离

            doc.style.webkitTransition = "all 0s";
            doc.style.webkitTransform = "translate3D(" + nowLeft + "px," + nowTop + "px,0px)";

        };
        var clear = function () {
            ticking1 = false;
            var nowLeft = parseInt(doc.lefts);   //滑动的距离
            var nowTop = parseInt(doc.tops);    //滑动的距离

            doc.style.webkitTransform = "translate3D(0px,0px,0px)";
            doc.style.webkitTransformOrigin = "50%";
            doc.style.webkitTransition = "all 1s ease-out, border .4s, background-color .6s";

        };
    }
    /* 控制拖动end */
</script>
<script type="text/javascript" src="../js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="../js/jquery.form.js"></script>
<script>
    $(document).ready(function () {
        var x_out = document.documentElement.clientWidth + document.body.scrollLeft;
        var y_out = document.documentElement.clientHeight + document.body.scrollTop + 1;
        document.getElementById('body').style.width = x_out + 'px';
        document.getElementById('body').style.height = y_out + 'px';
        document.title = "Jerry" + "在你心中是怎样的一个人？";
        var sex = $('#img').attr('data-sex');
        if(sex == 1){
            $('body').css('background','url("../images/d11/2016d11-bbg.jpg") no-repeat');
        }else{
            $('body').css('background','url("../images/d11/2016d11-gbg.jpg") no-repeat');
        }
        var change = false;

        $('.button').click(function (e) {
            var index = $(this).attr('data-index');
            var str = $(this).html();
            var strs = str.split('<br>');
            if(strs.length > 2) {
                var label = strs[0] + '<br>' + strs[1];
            }else {
                var label = strs[0];
            }
            var temp = "button" + index;
            var opa = document.getElementById(temp).style.opacity;
            var con = "contain" + index;
            var text = "text" + index;
            if ($(this).attr('data-clicked') == 0) {
                var number = 0;
                for(var i=0;i<$('.button').length;i++){
                    if($('.button').eq(i).attr('data-clicked') == 1){
                        number++;
                    }
                }
                if(number >=4){
                    alert('啊哦，我哪有那么贪心，四个就够了！');
                    return false;
                }
                opa = parseFloat(opa) + 0.1;
                var $tmp = label + "<br>(" + (parseInt($(this).attr('data-count')) + 1) + ")";
                $('#' + temp).html($tmp).css('opacity',opa);
                $(this).siblings('.d11-heart').addClass('happy');
                $(this).siblings('.d11-break1').removeClass('break1');
                $(this).siblings('.d11-break2').removeClass('break2');
                if (sex == 1) {
                    $('#' +temp).addClass('border-clicked1');
                }
                else {
                    $('#' +temp).addClass('border-clicked2');
                }
                $('#' + text).addClass('text_active');
                $(this).attr('data-clicked',1);
                if (change) {
                    if(sex==1) {
                        $('.button').css('background-color','rgba(0,0,0,0.5)');
                    }
                    else {
                        $('.button').css('background-color','rgba(0,0,0,0.35)');
                    }
                    for (var i = data.change.length - 1; i >= 0; i--) {
                        var temp1 = data.change[i].replace('lab','');
                        temp1 = 'button' + temp1;
                        if (sex==1) {
                            document.getElementById(temp1).style.backgroundColor = "rgba(48,90,86,0.6)";
                        }
                        else {
                            document.getElementById(temp1).style.backgroundColor = "rgba(208,90,110,0.4)";
                        }
                    }
                }
            } else if ($(this).attr('data-clicked') == 1) {
                opa = parseFloat(opa) - 0.1;
                var tmp = label + "<br>(" + $(this).attr('data-count') + ")";
                $('#' + temp).html(tmp).css('opacity',opa);
                if (sex == 1) {
                    $('#' +temp).removeClass('border-clicked1');
                }
                else {
                    $('#' +temp).removeClass('border-clicked2');
                }
                $(this).siblings('.d11-heart').removeClass('happy');
                $('#' + text).removeClass('text_active');
                $(this).attr('data-clicked',0);
                $(this).siblings('.d11-break1').addClass('break1');
                $(this).siblings('.d11-break2').addClass('break2');
            }
        });

        $('#img').click(function (e) {
            if (!change) {
                for (var i = data.length - 1; i >= 0; i--) {
                    temp = data[i].replace('lab', '');
                    temp = 'button' + temp;
                    if (sex == 1) {
                        document.getElementById(temp).style.backgroundColor = "rgba(48,90,86,0.6)";
                    }
                    else {
                        document.getElementById(temp).style.backgroundColor = "rgba(208,90,110,0.4)";
                    }

                }
                change = true;
            }
            else {
                for (var i = data.length - 1; i >= 0; i--) {
                    temp = data[i].replace('lab', '');
                    temp = 'button' + temp;
                    if (sex == 1) {
                        document.getElementById(temp).style.backgroundColor = "rgba(0,0,0,0.5)";
                    }
                    else {
                        document.getElementById(temp).style.backgroundColor = "rgba(0,0,0,0.35)";
                    }
                }
                change = false;
            }
        });
        /* 音乐控制 */
        $('#cardsound').on('click',function() {
            var au = $("#audioPlay");
            var ai = $("#sound_image");
            if (au[0].paused) {
                au[0].play();
                ai.css('-webkit-animation',"zhuan 1s linear infinite");
                ai.css('animation',"zhuan 1s linear infinite");
                $("#music_txt").html("打开").css('visibility',"visible");
                setTimeout(function () {
                    $("#music_txt").css('visibility',"hidden");
                }, 2500);
            } else {
                au[0].pause();
                ai.css('-webkit-animation',"none");
                ai.css('animation',"none");
                $("#music_txt").html("关闭").css('visibility',"visible");
                setTimeout(function () {
                    $("#music_txt").css('visibility',"hidden");
                }, 2500);
            }
        });
        /* 音乐控制end */
        $('.double11-sure').click(function () {
            $(this).parents('.double11-mask').hide();
        });
        $('.double11-guess').on('click', function () {
            $('.double11-mask').show();
        });
    });
</script>
</body>
</html>
